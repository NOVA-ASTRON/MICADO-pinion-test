#ifndef DRIVERDEV_H
#define DRIVERDEV_H
#include "logfile.h"
#include <QtSerialPort/QSerialPort>
#include <string>
#include <mutex>
#include <QTimer>
#include <QTime>
#include <QCoreApplication>

typedef struct deviceinfo_t
{
    std::string ID;
    int baud;
}deviceinfo;

typedef struct deviceState_t
{
    std::string name;
    bool connected;
}deviceState;

typedef struct cmd_t {
    const char * cmd;
    int length;
} Command;


void msdelay(int ms);
#define null nullptr;
//typedef class SerialPort_t * SerialPort;
//class SerialDataReceivedEventArgs;
//typedef std::mutex * object;
const deviceinfo * DeviceInfoFromName(std::string &name);

class DriverDev : public QObject
   {
        Q_OBJECT
public:
       QSerialPort *serial = null;
       deviceinfo myID;
       std::string name;
       LogFile log = null;
       std::mutex _lock;

       DriverDev(QObject *parent = nullptr);

       QSerialPort *FindSerialPort(deviceinfo dev);

       bool Connect();

       void Disconnect();
       void InitDriverDev(const deviceinfo *ID, LogFile l, std::string n);



       virtual void incomingbytes(QByteArray & arr)
       {
           (void)arr;
       }

       void addHandler();

       void processincomingbytes();
       bool SendCommand(Command & command, std::string err);

       deviceState GetDeviceState();

       bool getValid() const;

private:
       QByteArray IncomingData;
       bool valid;
   };

#endif // DRIVERDEV_H
